var sliders=[document.getElementById("slide-red"),document.getElementById("slide-blue"),document.getElementById("slide-green")],getColours=function(){var red=document.getElementsByName("red")[0].value,green=document.getElementsByName("green")[0].value,blue=document.getElementsByName("blue")[0].value;return{red:red,green:green,blue:blue}};window.setInterval(function(){try{for(var decay=[5,30,60],squares=document.querySelectorAll(".square time"),i=0;i<squares.length;i+=1){var timestamp=new Date(squares[i].getAttribute("datetime")),timeDiff=Math.floor(Math.abs(timestamp-Date.now())/1e3/60),square=squares[i].parentNode;timeDiff<decay[0]?square.className="square decay-0":timeDiff<decay[1]?square.className="square decay-1":timeDiff<decay[2]?square.className="square decay-2":square.className="square decay-3"}}catch(e){}},500);var updateColour=function(){var colours=getColours();document.getElementById("current").style.backgroundColor="rgb("+colours.red+","+colours.green+","+colours.blue+")"};if(document.getElementById("red").addEventListener("change",updateColour),document.getElementById("green").addEventListener("change",updateColour),document.getElementById("blue").addEventListener("change",updateColour),"range"===sliders[0].type)for(var changeSlider=function(e){var value=e.target.value,colour=document.getElementsByName(e.target.name.replace("slide-",""))[0];colour.value=value,updateColour()},i=0;i<sliders.length;i+=1)sliders[i].addEventListener("change",changeSlider),document.getElementById("sliders").className+=" visible",document.getElementById("sliders").style.display="block";var lightSquare=function(square){var target=document.getElementsByName("square")[square.id-1];target.innerHTML=square.contents,target.style.backgroundColor="rgb("+square.colour.red+","+square.colour.green+","+square.colour.blue+")",target.style.borderColor="rgb("+square.author.red+","+square.author.green+","+square.author.blue+")"},lightHome=function(square){document.getElementById("home-notification-colour").style.fill="rgb("+square.colour.red+","+square.colour.green+","+square.colour.blue+")",document.getElementById("home-notification-author").style.fill="rgb("+square.author.red+","+square.author.green+","+square.author.blue+")"};if(window.WebSocket){document.getElementById("refresh").style.display="none";var connectSocket=function(){var websocket=new WebSocket("ws://"+document.location.host);websocket.onmessage=function(evt){var message;try{message=JSON.parse(evt.data)}catch(e){console.log(e)}message&&("squares"===message.type?message.content&&message.content.squares&&message.content.squares.forEach(function(square){lightSquare(square)}):"home"===message.type&&lightHome(message.content))},websocket.onopen=function(){var message={type:"pair",squarefield:window.squarefieldName};websocket.send(JSON.stringify(message));var homeMessage={type:"homePair",squarefield:window.sessionSquarefieldName};websocket.send(JSON.stringify(homeMessage))},websocket.onclose=function(close){setTimeout(function(){connectSocket()},2e3)}};connectSocket();for(var squares=document.querySelectorAll(".square"),sendRequest=function(event){for(var currentMode,modes=document.getElementsByName("mode"),m=0;m<modes.length;m+=1)modes[m].checked&&(currentMode=modes[m].value);if("paint"===currentMode){var red=document.getElementById("red").value,green=document.getElementById("green").value,blue=document.getElementById("blue").value,square=event.currentTarget.value,string="square="+square+"&red="+red+"&green="+green+"&blue="+blue,http=new XMLHttpRequest;http.open("POST",document.location.pathname,!0),http.setRequestHeader("Content-type","application/x-www-form-urlencoded");var params=string;return http.send(params),event.preventDefault(),!1}},i=0;i<squares.length;i+=1)squares[i].addEventListener("click",sendRequest,!1)}